이 쿠버네티스(Kubernetes) 설정 스크립트는 사용자가 쿠버네티스를 손쉽게 설치하고 설정할 수 있도록 다양한 작업을 자동화합니다. 주로 Ubuntu 리눅스 환경에서 동작하도록 설계되었으며, 마스터 노드와 워커 노드를 구분하여 설정할 수 있습니다. 이 글에서는 각 스크립트가 어떤 역할을 하는지 간단하게 설명하고, 이 설정을 블로그 글로 작성하는 방안을 제안합니다.

### 블로그 글 제목

**"Ubuntu에서 쿠버네티스(Kubernetes) 클러스터 간편 설치 및 설정 스크립트 가이드"**

### 소개

이 글에서는 리눅스 환경에서 쿠버네티스 클러스터를 쉽게 설치하고 설정하는 방법을 설명합니다. 이를 위해 필요한 모든 과정을 스크립트화하여, 자동화된 설정을 통해 마스터 노드와 워커 노드를 간편하게 구성할 수 있습니다. 본 가이드는 Ubuntu 기반의 시스템을 기준으로 작성되었습니다.

### 1. 스크립트 개요

설정을 자동화하기 위해 만든 스크립트는 총 5개의 주요 단계로 구성됩니다:

- **`kubectlInstaller.sh`**: 쿠버네티스 클라이언트 도구인 `kubectl`을 설치합니다.
- **`kubeadmInstaller.sh`**: 쿠버네티스 클러스터 관리 도구인 `kubeadm`을 설치합니다.
- **`container.sh`**: 쿠버네티스 클러스터에서 사용할 컨테이너 런타임 `containerd`를 설치합니다.
- **`k8sPackage.sh`**: 쿠버네티스 패키지 및 네트워크 플러그인을 설치합니다.
- **`nodeSetting.sh`**: 마스터 또는 워커 노드를 설정합니다.

이 스크립트를 실행함으로써 복잡한 설치 과정을 간소화할 수 있습니다. 아래에서 각 스크립트가 하는 작업을 좀 더 자세히 설명하겠습니다.

### 2. 스크립트별 상세 설명

#### 2.1 `kubectlInstaller.sh`

이 스크립트는 최신 stable 버전의 `kubectl`을 다운로드하고 설치합니다.

- 운영체제와 아키텍처를 자동으로 감지하여 맞춤형 설치 파일을 가져옵니다.
- `kubectl` 바이너리의 무결성을 체크섬을 통해 검증하며, 검증 후에는 `/usr/local/bin` 디렉터리에 설치합니다.

#### 2.2 `kubeadmInstaller.sh`

쿠버네티스 설치의 핵심 도구인 `kubeadm`, `kubelet`, `kubectl`을 설치하는 스크립트입니다.

- Ubuntu에서 기본적으로 제공되지 않는 Kubernetes 레포지토리를 추가하고 패키지를 설치합니다.
- 설치 후 `kubelet`을 활성화하고 자동 시작을 설정합니다.

#### 2.3 `container.sh`

이 스크립트는 컨테이너 런타임 `containerd`를 설치하고, 시스템을 적절히 설정합니다.

- 컨테이너 런타임으로 `containerd`를 사용하도록 쿠버네티스를 설정하며, `SystemdCgroup`을 활성화하여 시스템 자원 관리를 개선합니다.

#### 2.4 `k8sPackage.sh`

쿠버네티스 클러스터를 구성할 때 필요한 패키지들을 설치하는 스크립트입니다.

- IP 포워딩을 활성화하고, 브리지 네트워크 필터링을 설정합니다.
- 네트워크 플러그인으로 `Calico`를 설치하여 클러스터 내부 네트워크 통신을 설정합니다.

#### 2.5 `nodeSetting.sh`

이 스크립트는 마스터 노드 또는 워커 노드를 설정하는 과정입니다.

- 사용자가 입력한 정보를 바탕으로 `kubeadm`을 사용하여 마스터 노드를 초기화하거나, 워커 노드를 마스터에 조인시킵니다.
- 마스터 노드에서는 워커 노드를 추가할 수 있는 토큰과 명령어를 생성하여 제공합니다.

### 3. 스크립트 실행 방법

모든 스크립트는 다음 명령어를 통해 실행할 수 있습니다:

```bash
./setup.sh
```

이 스크립트는 운영체제를 자동으로 감지하여 적합한 패키지와 설정을 설치하며, 사용자는 마스터 또는 워커 노드를 선택하여 설정할 수 있습니다. 리눅스에서는 방화벽 설정을 자동으로 적용해주며, `Calico` 네트워크 플러그인을 설치하여 쿠버네티스의 네트워크 설정을 완료합니다.

### 4. 결론

이 스크립트는 복잡한 쿠버네티스 설치 과정을 자동화하여 사용자가 손쉽게 클러스터를 구성할 수 있도록 돕습니다. 마스터 노드와 워커 노드를 구분하여 필요한 방화벽 설정과 노드 간 통신 설정도 간편하게 적용됩니다. 쿠버네티스를 처음 사용하는 사용자나 복잡한 설정이 부담스러운 개발자에게 이 스크립트는 매우 유용할 것입니다.

### 예시 코드

블로그 글에서 보여줄 코드 예시는 설정 스크립트와 각 단계별 스크립트의 간단한 부분을 소개할 수 있습니다.

예시로, `kubectlInstaller.sh`의 설치 스크립트는 다음과 같습니다:

```bash
#!/bin/bash

# 운영체제 감지
OS=$(uname | tr '[:upper:]' '[:lower:]')

# 아키텍처 감지
ARCH=$(uname -m)

# kubectl 최신 버전 다운로드
VERSION=$(curl -L -s https://dl.k8s.io/release/stable.txt)
URL="https://dl.k8s.io/release/${VERSION}/bin/${OS}/${ARCH}/kubectl"
curl -LO "$URL"

# 실행 권한 부여 및 설치
chmod +x kubectl
sudo mv kubectl /usr/local/bin/kubectl
```

이와 같은 예시는 글에서 코드 설명을 쉽게 이해할 수 있도록 도와줄 수 있습니다.

### 마지막으로

이 스크립트를 사용하면 쿠버네티스 설정 시간을 크게 줄일 수 있으며, 복잡한 과정을 자동화하여 운영체제에 관계없이 원활한 설치가 가능합니다.
